<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zərrəciklərin Cazibəsi - Kosmik Kürə</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #020205; /* Daha dərin kosmik qara */
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    const windowId = Math.random().toString(36).substr(2, 9);
    let particles = [];
    // Zərrəcik sayını artırırıq ki, "küre" dolğun görünsün
    const particleCount = 800; 
    
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }

    window.addEventListener('resize', resize);
    resize();

    class Particle {
        constructor() {
            this.init();
        }

        init() {
            // Başlanğıcda zərrəcikləri kürə formasında paylayırıq
            const angle = Math.random() * Math.PI * 2;
            const radius = Math.random() * 80; 
            this.x = canvas.width / 2 + Math.cos(angle) * radius;
            this.y = canvas.height / 2 + Math.sin(angle) * radius;
            
            this.vx = (Math.random() - 0.5) * 1;
            this.vy = (Math.random() - 0.5) * 1;
            
            // Fərqli ölçülər daha təbii toz/enerji görüntüsü verir
            this.radius = Math.random() * 1.5 + 0.5;
            
            // Rəng palitrası: Mavi, bənövşəyi və ağ tonları (Dünya/Enerji effekti)
            const colors = ['#4fc3f7', '#81d4fa', '#e1f5fe', '#7e57c2'];
            this.color = colors[Math.floor(Math.random() * colors.length)];
            this.opacity = Math.random() * 0.6 + 0.2;
        }

        update(otherWindows) {
            let targetX = canvas.width / 2;
            let targetY = canvas.height / 2;
            let isAttracted = false;

            // Digər pəncərələri yoxla
            otherWindows.forEach(win => {
                if (win.id === windowId) return;

                const myAbsX = window.screenX + this.x;
                const myAbsY = window.screenY + this.y;
                const otherAbsX = win.screenX + win.width / 2;
                const otherAbsY = win.screenY + win.height / 2;

                const dx = otherAbsX - myAbsX;
                const dy = otherAbsY - myAbsY;
                const distance = Math.sqrt(dx * dx + dy * dy);

                // Əgər digər pəncərə yaxındırsa, hədəfi oraya yönəlt
                if (distance < 1000) {
                    const force = (1000 - distance) / 1000;
                    this.vx += (dx / distance) * force * 0.8;
                    this.vy += (dy / distance) * force * 0.8;
                    isAttracted = true;
                }
            });

            // Əgər cazibə yoxdursa, mərkəzi kürəyə qayıt
            if (!isAttracted) {
                const dxBase = (canvas.width / 2) - this.x;
                const dyBase = (canvas.height / 2) - this.y;
                const distBase = Math.sqrt(dxBase * dxBase + dyBase * dyBase);
                
                // Kürə forması saxlamaq üçün yumşaq daxili qüvvə
                if (distBase > 100) {
                    this.vx += dxBase * 0.002;
                    this.vy += dyBase * 0.002;
                } else {
                    // Kürə daxilində axıcı hərəkət
                    this.vx += (Math.random() - 0.5) * 0.2;
                    this.vy += (Math.random() - 0.5) * 0.2;
                }
            }

            // Sürtünmə
            this.vx *= 0.92;
            this.vy *= 0.92;

            this.x += this.vx;
            this.y += this.vy;
        }

        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.globalAlpha = this.opacity;
            ctx.fill();
            ctx.globalAlpha = 1.0;
        }
    }

    for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle());
    }

    function updateWindowState() {
        const state = {
            id: windowId,
            screenX: window.screenX,
            screenY: window.screenY,
            width: window.innerWidth,
            height: window.innerHeight,
            timestamp: Date.now()
        };
        localStorage.setItem(`win_${windowId}`, JSON.stringify(state));
    }

    function getOtherWindows() {
        const windows = [];
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('win_')) {
                try {
                    const win = JSON.parse(localStorage.getItem(key));
                    if (Date.now() - win.timestamp < 1000) {
                        windows.push(win);
                    } else {
                        localStorage.removeItem(key);
                    }
                } catch(e) {}
            }
        }
        return windows;
    }

    function drawGlow() {
        // Mərkəzdəki kürəyə atmosferik parıltı veririk
        const grad = ctx.createRadialGradient(
            canvas.width / 2, canvas.height / 2, 0,
            canvas.width / 2, canvas.height / 2, 150
        );
        grad.addColorStop(0, 'rgba(64, 150, 255, 0.15)');
        grad.addColorStop(1, 'rgba(0, 0, 0, 0)');
        
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function animate() {
        // "Trail" effekti üçün tam təmizləmirik, azca şəffaflıq saxlayırıq
        ctx.fillStyle = 'rgba(2, 2, 5, 0.15)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        drawGlow();
        updateWindowState();
        const otherWindows = getOtherWindows();

        particles.forEach(p => {
            p.update(otherWindows);
            p.draw();
        });

        requestAnimationFrame(animate);
    }

    window.onload = animate;

    window.onunload = () => {
        localStorage.removeItem(`win_${windowId}`);
    };
</script>
</body>
</html>
