<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axtarget Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: white; min-height: 100vh; overflow: hidden; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .webcam-preview { width: 180px; height: 135px; border-radius: 12px; border: 2px solid #3b82f6; position: absolute; z-index: 50; object-fit: cover; transition: 0.3s; }
        .pos-bottom-left { bottom: 20px; left: 20px; }
        .pos-bottom-right { bottom: 20px; right: 20px; }
        .quality-btn.active { background: #3b82f6; border-color: #60a5fa; }
    </style>
</head>
<body class="flex items-center justify-center">

    <div class="relative w-full max-w-4xl p-6">
        <div class="glass rounded-[32px] p-8 shadow-2xl relative overflow-hidden">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">Axtarget Studio</h1>
                    <p class="text-slate-500 text-xs tracking-widest uppercase">Professional Recorder</p>
                </div>
                <div id="status" class="hidden flex items-center gap-2 bg-red-500/20 text-red-400 px-3 py-1 rounded-full text-xs font-bold">
                    <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span> REC <span id="timer">00:00</span>
                </div>
            </div>

            <div class="relative aspect-video bg-slate-900 rounded-2xl mb-8 border border-white/5 flex items-center justify-center overflow-hidden">
                <video id="preview" class="w-full h-full object-contain hidden" controls></video>
                <div id="blank" class="text-slate-700 flex flex-col items-center">
                    <i class="fas fa-desktop text-5xl mb-4 opacity-20"></i>
                    <p class="text-sm italic opacity-40">Görüntü gözlənilir...</p>
                </div>
                <video id="webcam" class="webcam-preview hidden pos-bottom-right" autoplay muted></video>
            </div>

            <div class="flex items-center justify-center gap-4">
                <button id="record-btn" class="flex-1 bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-bold flex items-center justify-center gap-3 transition-all shadow-lg shadow-blue-900/20">
                    <i class="fas fa-circle text-xs"></i> Ekranı Kaydet
                </button>
                <button id="stop-btn" class="hidden flex-1 bg-red-600 hover:bg-red-500 py-4 rounded-2xl font-bold flex items-center justify-center gap-3 transition-all">
                    <i class="fas fa-stop"></i> Durdur
                </button>
                <button id="settings-toggle" class="w-16 h-14 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl flex items-center justify-center transition-all">
                    <i class="fas fa-cog"></i>
                </button>
            </div>

            <div id="result-btns" class="hidden mt-6 flex gap-3">
                <button id="download-btn" class="flex-1 bg-emerald-600 hover:bg-emerald-500 py-3 rounded-xl font-bold">Yüklə</button>
                <button id="delete-btn" class="w-16 bg-white/5 hover:bg-red-500/20 border border-white/10 rounded-xl"><i class="fas fa-trash"></i></button>
            </div>
        </div>
    </div>

    <div id="settings-panel" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div class="glass w-full max-w-md rounded-[24px] p-6 animate-fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">Ayarlar</h2>
                <button id="close-settings" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
            </div>

            <div class="space-y-6">
                <div>
                    <label class="text-xs text-slate-500 font-bold uppercase mb-3 block">Video Keyfiyyəti</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button class="quality-btn p-2 border border-white/10 rounded-lg text-sm" data-val="2160">4K</button>
                        <button class="quality-btn p-2 border border-white/10 rounded-lg text-sm" data-val="1440">2K</button>
                        <button class="quality-btn active p-2 border border-white/10 rounded-lg text-sm" data-val="1080">1080p</button>
                        <button class="quality-btn p-2 border border-white/10 rounded-lg text-sm" data-val="720">720p</button>
                    </div>
                </div>

                <div class="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/10">
                    <span class="text-sm">Veb-kamera</span>
                    <input type="checkbox" id="cam-check" class="w-5 h-5 accent-blue-500">
                </div>

                <div id="cam-pos-box" class="hidden grid grid-cols-2 gap-2">
                    <button id="pos-left" class="p-2 bg-white/5 border border-white/10 rounded-lg text-xs">Sol Aşağı</button>
                    <button id="pos-right" class="p-2 bg-blue-600 border border-blue-500 rounded-lg text-xs">Sağ Aşağı</button>
                </div>

                <div class="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/10">
                    <span class="text-sm">Mikrofon</span>
                    <input type="checkbox" id="mic-check" checked class="w-5 h-5 accent-blue-500">
                </div>
            </div>
        </div>
    </div>

    <script>
        let mediaRecorder, chunks = [], timer, start, mStream, wStream, quality = 1080;

        const btnRec = document.getElementById('record-btn'), btnStop = document.getElementById('stop-btn');
        const setPanel = document.getElementById('settings-panel'), setToggle = document.getElementById('settings-toggle');
        const camCheck = document.getElementById('cam-check'), vWebcam = document.getElementById('webcam');

        setToggle.onclick = () => setPanel.classList.remove('hidden');
        document.getElementById('close-settings').onclick = () => setPanel.classList.add('hidden');

        document.querySelectorAll('.quality-btn').forEach(b => {
            b.onclick = () => {
                document.querySelectorAll('.quality-btn').forEach(x => x.classList.remove('active'));
                b.classList.add('active');
                quality = parseInt(b.dataset.val);
            }
        });

        camCheck.onchange = async () => {
            if (camCheck.checked) {
                try {
                    wStream = await navigator.mediaDevices.getUserMedia({ video: true });
                    vWebcam.srcObject = wStream;
                    vWebcam.classList.remove('hidden');
                    document.getElementById('cam-pos-box').classList.remove('hidden');
                } catch { camCheck.checked = false; }
            } else {
                if (wStream) wStream.getTracks().forEach(t => t.stop());
                vWebcam.classList.add('hidden');
                document.getElementById('cam-pos-box').classList.add('hidden');
            }
        };

        document.getElementById('pos-left').onclick = () => {
            vWebcam.className = 'webcam-preview pos-bottom-left';
            document.getElementById('pos-left').classList.add('bg-blue-600');
            document.getElementById('pos-right').classList.remove('bg-blue-600');
        };
        document.getElementById('pos-right').onclick = () => {
            vWebcam.className = 'webcam-preview pos-bottom-right';
            document.getElementById('pos-right').classList.add('bg-blue-600');
            document.getElementById('pos-left').classList.remove('bg-blue-600');
        };

        btnRec.onclick = async () => {
            try {
                const sStream = await navigator.mediaDevices.getDisplayMedia({
                    video: { width: { ideal: (quality * 16) / 9 }, height: { ideal: quality } },
                    audio: true
                });
                let tracks = [...sStream.getTracks()];
                if (document.getElementById('mic-check').checked) {
                    const m = await navigator.mediaDevices.getUserMedia({ audio: true });
                    tracks = [...tracks, ...m.getAudioTracks()];
                }
                mStream = new MediaStream(tracks);
                mediaRecorder = new MediaRecorder(mStream, { mimeType: 'video/webm;codecs=vp9' });
                chunks = [];
                mediaRecorder.ondataavailable = e => chunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const b = new Blob(chunks, { type: 'video/webm' });
                    document.getElementById('preview').src = URL.createObjectURL(b);
                    document.getElementById('preview').classList.remove('hidden');
                    document.getElementById('blank').classList.add('hidden');
                    document.getElementById('result-btns').classList.remove('hidden');
                    document.getElementById('status').classList.add('hidden');
                    btnStop.classList.add('hidden');
                    btnRec.classList.remove('hidden');
                    clearInterval(timer);
                    mStream.getTracks().forEach(t => t.stop());
                };
                mediaRecorder.start();
                btnRec.classList.add('hidden');
                btnStop.classList.remove('hidden');
                document.getElementById('status').classList.remove('hidden');
                document.getElementById('result-btns').classList.add('hidden');
                start = Date.now();
                timer = setInterval(() => {
                    const d = new Date(Date.now() - start);
                    document.getElementById('timer').textContent = d.toISOString().substr(14, 5);
                }, 1000);
                sStream.getVideoTracks()[0].onended = () => mediaRecorder.stop();
            } catch {}
        };

        btnStop.onclick = () => mediaRecorder.stop();
        document.getElementById('delete-btn').onclick = () => {
            document.getElementById('preview').src = "";
            document.getElementById('preview').classList.add('hidden');
            document.getElementById('blank').classList.remove('hidden');
            document.getElementById('result-btns').classList.add('hidden');
        };
        document.getElementById('download-btn').onclick = () => {
            const a = document.createElement('a');
            a.href = document.getElementById('preview').src;
            a.download = 'record.webm';
            a.click();
        };
    </script>
</body>
</html>
