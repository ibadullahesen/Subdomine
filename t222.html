<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FilmLand - Premium Cinema Hub</title>
    <!-- React və ReactDOM kitabxanalarını stabil versiyada yükləyirik -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Babel transpayler -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; margin: 0; overflow-x: hidden; }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .animate-bounce { animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); } 50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); } }
        input[type="range"] { -webkit-appearance: none; appearance: none; background: transparent; cursor: pointer; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; height: 12px; width: 12px; background-color: #ef4444; border-radius: 50%; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDK - Vahid Modul olaraq -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA-S0YXpHTqpDQtaOBFdS19DKyX02Lip9A",
            authDomain: "ustasan-mmc.firebaseapp.com",
            projectId: "ustasan-mmc",
            storageBucket: "ustasan-mmc.firebasestorage.app",
            messagingSenderId: "577498196584",
            appId: "1:577498196584:web:d629620b15a12919b2a9dd"
        };

        // Firebase-i qlobal obyektə bağlayırıq ki, React tərəfindən istifadə oluna bilsin
        const app = initializeApp(firebaseConfig);
        window.fbDB = getFirestore(app);
        window.fbAuth = getAuth(app);
        window.fbUtils = { collection, onSnapshot, signInAnonymously, onAuthStateChanged };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // İkonlar üçün SVG Helper
        const Icon = ({ name, size = 24, className = "", fill = "none" }) => {
            const pathMap = {
                Play: "m6 3 14 9-14 9V3z",
                Pause: "M6 4h4v16H6zM14 4h4v16h-4z",
                RotateCcw: "M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",
                RotateCw: "M21 12a9 9 0 1 1-9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",
                Volume2: "M11 5 6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 0 1 0 7.07M19.07 4.93a10 10 0 0 1 0 14.14",
                VolumeX: "M11 5 6 9H2v6h4l5 4V5zM23 9l-6 6M17 9l6 6",
                Maximize: "M8 3H5a2 2 0 0 0-2 2v3M21 8V5a2 2 0 0 0-2-2h-3M3 16v3a2 2 0 0 0 2 2h3M16 21h3a2 2 0 0 0 2-2v-3",
                Star: "m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",
                Film: "m22 8-6 4 6 4V8zM2 6h14v12H2z",
                ShieldCheck: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10zM9 12l2 2 4-4",
                Loader2: "M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83",
                Clapperboard: "m20.2 6-2.1 3H20l2 12H2L4 9h1.9l2.1-3h3.8l-2.1 3H12l2.1-3h3.8l-2.1 3H21"
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d={pathMap[name]} />
                </svg>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [movies, setMovies] = useState([]);
            const [selectedMovie, setSelectedMovie] = useState(null);
            const [loading, setLoading] = useState(true);
            const videoRef = useRef(null);
            const [isPlaying, setIsPlaying] = useState(false);
            const [isBuffering, setIsBuffering] = useState(true);
            const [currentTime, setCurrentTime] = useState(0);
            const [duration, setDuration] = useState(0);
            const [isMuted, setIsMuted] = useState(true);
            const [showControls, setShowControls] = useState(true);
            const controlsTimeoutRef = useRef(null);
            const appId = "filmland-official-v1";

            useEffect(() => {
                const checkFirebase = setInterval(() => {
                    if (window.fbAuth && window.fbDB) {
                        clearInterval(checkFirebase);
                        initializeApp();
                    }
                }, 100);

                const initializeApp = async () => {
                    const { signInAnonymously, onAuthStateChanged, collection, onSnapshot } = window.fbUtils;
                    
                    try {
                        await signInAnonymously(window.fbAuth);
                        onAuthStateChanged(window.fbAuth, (usr) => {
                            setUser(usr);
                            if (usr) {
                                const moviesRef = collection(window.fbDB, 'artifacts', appId, 'public', 'data', 'movies');
                                onSnapshot(moviesRef, (snapshot) => {
                                    if (!snapshot.empty) {
                                        const moviesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                                        setMovies(moviesData);
                                        setSelectedMovie(prev => prev || moviesData[0]);
                                        setLoading(false);
                                    }
                                });
                            }
                        });
                    } catch (err) {
                        console.error("Auth error:", err);
                        setLoading(false);
                    }
                };
            }, []);

            useEffect(() => {
                if (selectedMovie && videoRef.current) {
                    setIsBuffering(true);
                    videoRef.current.load();
                    const playPromise = videoRef.current.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => setIsPlaying(true)).catch(() => setIsPlaying(false));
                    }
                }
            }, [selectedMovie]);

            const togglePlay = () => {
                if (videoRef.current.paused) { videoRef.current.play(); setIsPlaying(true); } 
                else { videoRef.current.pause(); setIsPlaying(false); }
            };

            const formatTime = (time) => {
                const min = Math.floor(time / 60);
                const sec = Math.floor(time % 60);
                return `${min}:${sec < 10 ? '0' : ''}${sec}`;
            };

            const handleMouseMove = () => {
                setShowControls(true);
                clearTimeout(controlsTimeoutRef.current);
                controlsTimeoutRef.current = setTimeout(() => { if (isPlaying) setShowControls(false); }, 3000);
            };

            if (loading) {
                return (
                    <div className="bg-[#050505] h-screen flex flex-col items-center justify-center text-white gap-4">
                        <Icon name="Clapperboard" size={48} className="text-red-600 animate-bounce" />
                        <span className="text-[10px] font-black uppercase tracking-[0.4em]">Sistem Yüklənir</span>
                    </div>
                );
            }

            return (
                <div className="bg-[#0a0a0a] min-h-screen text-white pb-20">
                    <header className="fixed top-0 inset-x-0 z-[100] px-6 py-4 flex justify-between items-center bg-black/80 backdrop-blur-lg border-b border-white/5">
                        <div className="flex items-center gap-2 cursor-pointer">
                            <div className="bg-red-600 p-1.5 rounded transform -skew-x-12"><Icon name="Film" size={20} className="text-white" /></div>
                            <h1 className="text-xl font-black italic tracking-tighter uppercase">Film<span className="text-red-600">Land</span></h1>
                        </div>
                        <div className="hidden sm:flex items-center gap-2 bg-emerald-500/10 px-3 py-1 rounded-full border border-emerald-500/20">
                            <Icon name="ShieldCheck" size={12} className="text-emerald-500" />
                            <span className="text-[8px] font-bold uppercase tracking-widest text-emerald-500/80">Premium Player</span>
                        </div>
                    </header>

                    <main className="pt-20 lg:px-12 max-w-[1600px] mx-auto">
                        <section 
                            className="relative group w-full overflow-hidden bg-black lg:rounded-2xl shadow-2xl border border-white/5 mt-4 aspect-video"
                            onMouseMove={handleMouseMove}
                            onMouseLeave={() => isPlaying && setShowControls(false)}
                        >
                            {selectedMovie && (
                                <video 
                                    ref={videoRef}
                                    src={selectedMovie.videoUrl} 
                                    className="w-full h-full cursor-pointer"
                                    onTimeUpdate={() => setCurrentTime(videoRef.current.currentTime)}
                                    onWaiting={() => setIsBuffering(true)}
                                    onCanPlay={() => setIsBuffering(false)}
                                    onLoadedMetadata={() => setDuration(videoRef.current.duration)}
                                    onClick={togglePlay}
                                    autoPlay
                                    muted={isMuted}
                                    playsInline
                                />
                            )}

                            {isBuffering && (
                                <div className="absolute inset-0 flex items-center justify-center z-50 bg-black/20 backdrop-blur-[2px]">
                                    <div className="flex flex-col items-center gap-3">
                                        <Icon name="Loader2" size={64} className="text-red-600 animate-spin" />
                                        <span className="text-[10px] font-black uppercase tracking-[0.3em] animate-pulse">Yüklenir...</span>
                                    </div>
                                </div>
                            )}

                            <div className={`absolute inset-x-0 bottom-0 bg-gradient-to-t from-black via-black/40 to-transparent p-6 transition-opacity duration-500 ${showControls ? 'opacity-100' : 'opacity-0'}`}>
                                <div className="w-full mb-4 flex items-center relative h-1.5 group">
                                    <input 
                                        type="range" min="0" max={duration || 0} value={currentTime}
                                        onChange={(e) => { videoRef.current.currentTime = e.target.value; setCurrentTime(e.target.value); }}
                                        className="w-full h-full appearance-none bg-white/20 rounded-full z-10"
                                    />
                                    <div className="absolute left-0 h-full bg-red-600 rounded-full pointer-events-none" style={{ width: `${(currentTime / (duration || 1)) * 100}%` }} />
                                </div>

                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-6">
                                        <button onClick={togglePlay} className="hover:text-red-600 transform transition-all active:scale-90">
                                            {isPlaying ? <Icon name="Pause" size={32} fill="currentColor" /> : <Icon name="Play" size={32} fill="currentColor" />}
                                        </button>
                                        <div className="flex items-center gap-3">
                                            <button onClick={() => videoRef.current.currentTime -= 10} className="opacity-70 hover:opacity-100"><Icon name="RotateCcw" size={22} /></button>
                                            <button onClick={() => videoRef.current.currentTime += 10} className="opacity-70 hover:opacity-100"><Icon name="RotateCw" size={22} /></button>
                                        </div>
                                        <div className="flex items-center gap-2 text-xs font-mono opacity-60">
                                            {formatTime(currentTime)} <span className="opacity-30">/</span> {formatTime(duration)}
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        <button onClick={() => { setIsMuted(!isMuted); videoRef.current.muted = !isMuted; }}>
                                            {isMuted ? <Icon name="VolumeX" size={22} /> : <Icon name="Volume2" size={22} />}
                                        </button>
                                        <button onClick={() => videoRef.current.parentElement.requestFullscreen()} className="opacity-70 hover:opacity-100">
                                            <Icon name="Maximize" size={22} />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </section>

                        {selectedMovie && (
                            <section className="mt-8 px-6 lg:px-0">
                                <div className="bg-white/[0.03] p-8 rounded-3xl border border-white/5 flex flex-col md:flex-row justify-between gap-8">
                                    <div className="space-y-4 flex-1">
                                        <div className="flex items-center gap-4">
                                            <span className="bg-red-600 px-3 py-1 text-[10px] font-black rounded uppercase">{selectedMovie.category}</span>
                                            <div className="flex items-center gap-1.5 text-yellow-500 font-black"><Icon name="Star" size={16} fill="currentColor" /> {selectedMovie.rating}</div>
                                        </div>
                                        <h2 className="text-4xl md:text-6xl font-black italic tracking-tighter uppercase">{selectedMovie.title}</h2>
                                        <p className="text-gray-400 max-w-2xl italic leading-relaxed">{selectedMovie.description}</p>
                                    </div>
                                </div>
                            </section>
                        )}

                        <section className="mt-16 px-6 lg:px-0">
                            <h2 className="text-xl font-black tracking-widest uppercase italic mb-8 border-l-4 border-red-600 pl-4">Filmlər</h2>
                            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6">
                                {movies.map((movie) => (
                                    <div 
                                        key={movie.id} 
                                        onClick={() => { setSelectedMovie(movie); window.scrollTo({ top: 0, behavior: 'smooth' }); }}
                                        className={`group cursor-pointer rounded-xl overflow-hidden transition-all duration-500 ${selectedMovie?.id === movie.id ? 'ring-2 ring-red-600 scale-105' : 'opacity-40 hover:opacity-100 hover:scale-105'}`}
                                    >
                                        <div className="aspect-[2/3] relative">
                                            <img src={`https://images.unsplash.com/photo-1440404653325-ab127d49abc1?q=80&w=400&h=600&fit=crop&sig=${movie.id}`} className="w-full h-full object-cover" alt={movie.title} />
                                            <div className="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                                <Icon name="Play" fill="currentColor" size={40} className="text-red-600" />
                                            </div>
                                        </div>
                                        <div className="p-3 bg-black/40 text-[10px] font-black uppercase truncate">{movie.title}</div>
                                    </div>
                                ))}
                            </div>
                        </section>
                    </main>
                    <footer className="mt-20 py-10 text-center opacity-20 text-[9px] uppercase tracking-[1em] font-black">FilmLand Cinema Hub</footer>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
